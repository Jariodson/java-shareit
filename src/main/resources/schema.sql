DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS item CASCADE;
DROP TABLE IF EXISTS booking CASCADE;
DROP TABLE IF EXISTS comments CASCADE;

CREATE TABLE IF NOT EXISTS users (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(512) UNIQUE NOT NULL,
    time_created TIMESTAMP NOT NULL DEFAULT (CURRENT_TIMESTAMP())
);

CREATE TABLE IF NOT EXISTS item (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR,
    description VARCHAR,
    available BOOLEAN NOT NULL DEFAULT (false),
    user_id BIGINT NOT NULL,
    time_created TIMESTAMP NOT NULL DEFAULT (CURRENT_TIMESTAMP())
);
ALTER TABLE item
    ADD FOREIGN KEY (user_id) REFERENCES users (id);

CREATE TABLE IF NOT EXISTS booking (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    start_time TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    end_time TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    item_id BIGINT NOT NULL,
    booker_id BIGINT NOT NULL,
    status VARCHAR(60) NOT NULL,
    time_created TIMESTAMP NOT NULL DEFAULT (CURRENT_TIMESTAMP())
);
ALTER TABLE booking
    ADD FOREIGN KEY (item_id) REFERENCES item (id);
ALTER TABLE booking
    ADD FOREIGN KEY (booker_id) REFERENCES users (id);

CREATE TABLE IF NOT EXISTS comments (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    text VARCHAR NOT NULL,
    item_id BIGINT NOT NULL,
    author_id BIGINT NOT NULL,
    time_created TIMESTAMP NOT NULL DEFAULT (CURRENT_TIMESTAMP())
);
ALTER TABLE comments
    ADD FOREIGN KEY (item_id) REFERENCES item (id);
ALTER TABLE comments
    ADD FOREIGN KEY (author_id) REFERENCES users (id);

